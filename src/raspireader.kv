#:kivy 1.10.0
#:import os os


<RootWidget>:
  id: rootwidget
  Header:
    id: header
    ActionBar:
      pos_hint: {'top':1}
      ActionView:
        use_separator: True
        ActionPrevious:
          with_previous: False
          title: 'RasPiReader'
        ActionOverflow:
        ActionButton:
          text: "Start"
          on_press: root.ids.pagemanager.current = "startpage"
        ActionButton:
          text: "Options"
          on_press: root.ids.pagemanager.current = "optionspage"
        ActionButton:
          text: "Commit"
          on_press: root.ids.pagemanager.current = "commitpage"
        ActionButton:
          text: "Backup"
          on_press: root.ids.pagemanager.current = "backuppage"
  PageLayer:
    id: pagelayer
    PageManager:
      id: pagemanager
      StartPage:
        id: sp
      OptionsPage:
        id: op
      CommitPage:
        id: cp
      BackupPage:
        id: bp
  Footer:
    id: footer
    FooterButtons:
      Button:
        text: "Print To Screen"
        on_press: root.print_to_screen()

<HeaderButtons>:
  orientation: "horizontal"
  size_hint: 1, 0.1

<Header>:
  anchor_x: "center"
  anchor_y: "top"

<PageLayer>:
  anchor_x: "center"
  anchor_y: "center"

<FooterButtons>:
  orientation: "horizontal"
  size_hint: 1, 0.1

<Footer>:
  anchor_x: "center"
  anchor_y: "bottom"

<PageManager>:
  size_hint: 1, .8

<DownloadProgress>:
  title: 'Downloading {0}'.format(root.image)
  id: dlprogress
  BoxLayout:
    size: root.size
    pos: root.pos
    orientation: 'vertical'
    BoxLayout:
      id: progress_area
      Label:
        id: download_progress_counter
      ProgressBar:
        id: download_progress_bar
        max: 1
        value: 0
    BoxLayout:
      size_hint_y: None
      height: 30
      Button:
        text: "Cancel"
        on_release: root.cancel()

<FlashProgress>:
  title: 'Flashing {0} to {1}'.format(root.image, root.disk)
  id: flashprogress
  BoxLayout:
    size: root.size
    pos: root.pos
    orientation: 'vertical'
    BoxLayout:
      id: progress_area
      Label:
        id: flash_progress_counter
        text: root.progress_counter
      ProgressBar:
        id: flash_progress_bar
        max: 1
        value: root.progress_value
    BoxLayout:
      id: command_button
      size_hint_y: None
      height: 30
      Button:
        text: "Cancel"
        on_release: root.cancel()

<DownloadButton>:
  text: root.image
  size_hint_y: None
  height: 30
  on_release: app.root.DLIMGDialog.setDLImage(root.image)

<DownloadIMGDialog>:
  on_open: app.root.DLIMGDialog=self
  title: "Pick image"
  dl_image: None
  dl_disable: True
  StackLayout:
    id: layout1
    orientation: 'lr-bt'
    Button:
      text: "Cancel"
      size_hint: 0.9, 0.05
      on_release: root.cancel()
    ScrollView:
      id: scroll_view
      size_hint: 0.9, 0.95
      scroll_type: ['bars']
      GridLayout:
        id: layout2
        cols: 1
        size_hint_y: None
    Slider:
      id: slider
      min: 0
      max: 1
      value: 1
      orientation: 'vertical'
      size_hint: 0.1, 0.95

<LoadIMGDialog>:
  title: filechooser.path
  choosen_file: None
  BoxLayout:
    size: root.size
    pos: root.pos
    orientation: "vertical"
    FileChooserListView:
      id: filechooser
      path: os.getcwd()+'/images'
    BoxLayout:
      size_hint_y: None
      height: 30
      Button:
        text: "Cancel"
        on_release: root.cancel()
      Button:
        text: "Load"
        on_release: root.load(filechooser.path, filechooser.selection)

<SaveDialog>:
  text_input: text_input
  BoxLayout:
    size: root.size
    pos: root.pos
    orientation: "vertical"
    FileChooserListView:
      id: filechooser
      path: os.getcwd()
      on_selection: test_input.text = self.selection and self.selection[0] or ''
    TextInput:
      id: text_input
      size_hint_y: None
      height: 30
      multiline: False
    BoxLayout:
      size_hint_y: None
      height: 30
      Button:
        text: "Cancel"
        on_release: root.cancel()
      Button:
        text: "Save"
        on_release: root.save(filechooser.path. text_input.text)

<StartPage>:
  name: "startpage"
  GridLayout:
    rows: 2
    Label:
      size_hint: 1, 0.1
      text: "Start Page"
    StackLayout:
      Label:
        size_hint: 0.2, None
        height: 30
        text: "Local Image"
      TextInput:
        size_hint: .6, None
        height: 30
        multiline: False
        disabled: True
        id: img_label
        text: root.img_file
      Button:
        size_hint: .2, None
        height: 30
        text: "Load"
        on_release: root.file_pick()
      Label:
        size_hint: 0.2, None
        height: 30
        text: "Download Image"
      Button:
        size_hint: .6, None
        height: 30
        id: download_image
        text: root.download_file
        on_release: root.download_pick()
      Button:
        disabled: root.download_disable
        size_hint: .2, None
        height: 30
        text: "Download"
        on_release: root.download_image(root.download_file)

<OptionsPage>:
  name: "optionspage"
  GridLayout:
    rows:2
    BoxLayout:
      id: optionsmenue
      size_hint: 1, 0.1
    ScreenManager:
      id: optionsmanager
      size_hint: 1, 0.9

<BoolSetting>:
  cols: 2
  rows: 2
  Label:
    text: "Enable"
  Label:
    text: "Disable"
  CheckBox:
    id: enable
    group: "value"
  CheckBox:
    id: disable
    group: "value"

<SliderSetting>:
  rows: 2
  Label:
    id: value
    text: str(slider.value)
  Slider:
    id: slider
    step: 1

<SettingInfo>:
  rows: 2
  Label:
    id: name
    text: "tmp"
  GridLayout:
    cols: 2
    Label:
      text: "Enable setting"
    CheckBox:
      id: enable

<DropDownButton>:
  sd_not_chosen: True
  text: root.sd_card
  size_hint_y: None
  height: 30
  on_press: root.update()

<CommitPage>:
  name: "commitpage"
  id: commitpage
  GridLayout:
    rows: 2
    Label:
      size_hint: 1, 0.1
      text: "Commit Page"
    StackLayout:
      GridLayout:
        size_hint: 1, 0.3
        cols: 3
        Label:
          size_hint: 0.2, None
          height: 30
          text: "Pick SD card"
        Label:
          text: "Validate write"
          size_hint: 0.2, None
          height: 30
        Label:
          text: "Unmount on success"
          size_hint: 0.2, None
          height: 30
        Button:
          id: dd_btn
          text: root.sd
          size_hint: 0.2, None
          height: 30
          on_press: root.sd_dd()
        CheckBox:
          id: validate
          active: True
          size_hint: 0.2, None
          height: 30
        CheckBox:
          id: unmount
          active: True
          size_hint: 0.2, None
          height: 30
      Button:
        size_hint: 1, None
        id: sd_commit
        disabled: root.commit_disable
        text: "Commit to SD card"
        height: 60
        on_release: root.commit()


<BackupPage>:
  name: "backuppage"
  Label:
    text: "Backup Page"

